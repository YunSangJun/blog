<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/css/home.css">
  <link rel="stylesheet" href="/assets/css/category.css">
  <link rel="stylesheet" href="/assets/css/tag.css">
  <link rel="stylesheet" href="/assets/main.css"><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Terraform 사용하기 | 개발 노트</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Terraform 사용하기" />
<meta name="author" content="sj" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Terraform은 인프라를 코드로 관리할 수 있도록 지원하는 오픈소스 프로젝트입니다." />
<meta property="og:description" content="Terraform은 인프라를 코드로 관리할 수 있도록 지원하는 오픈소스 프로젝트입니다." />
<link rel="canonical" href="http://localhost:4000/terraform/2018/06/29/terraform.html" />
<meta property="og:url" content="http://localhost:4000/terraform/2018/06/29/terraform.html" />
<meta property="og:site_name" content="개발 노트" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-29T00:00:00+09:00" />
<script type="application/ld+json">
{"description":"Terraform은 인프라를 코드로 관리할 수 있도록 지원하는 오픈소스 프로젝트입니다.","author":{"@type":"Person","name":"sj"},"@type":"BlogPosting","url":"http://localhost:4000/terraform/2018/06/29/terraform.html","headline":"Terraform 사용하기","dateModified":"2018-06-29T00:00:00+09:00","datePublished":"2018-06-29T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/terraform/2018/06/29/terraform.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="article:tag" content="terraform" >
  
  <meta property="article:tag" content="iac" >
  
  <meta property="article:tag" content="infrastructure" >
  
  <meta property="article:tag" content="devops" >
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="개발 노트" /><meta name="naver-site-verification" content="33e13a38620284ab48998da35e7c8e63ec9c7319"/>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">개발 노트</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/categories">Categories</a>
            <a class="page-link" href="/tags">Tags</a>
        </div>

        <!--div class="trigger"><a class="page-link" href="/assets/images/oauth-proxy/2018-05-23-oauth-proxy.html">OAuth Proxy를 활용한 애플리케이션 인증 및 인가</a><a class="page-link" href="/categories/">Categories</a><a class="page-link" href="/tags/">Tags</a></div-->
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Terraform 사용하기</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-06-29T00:00:00+09:00" itemprop="datePublished">Jun 29, 2018
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">sj</span></span></p>
      
<img src="/assets/images/tag-256.png" alt="Tags: " class="tag-img"/>
<div class="post-tags">
  
  
  <a href="/tags/#terraform">terraform</a>,
  
  <a href="/tags/#iac">iac</a>,
  
  <a href="/tags/#infrastructure">infrastructure</a>,
  
  <a href="/tags/#devops">devops</a>
  
</div>
<br/>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Terraform은 인프라를 코드로 관리할 수 있도록 지원하는 오픈소스 프로젝트입니다.</p>

<p>멀티 클라우드를 사용하는 것이 최근 트렌드입니다. 그만큼 다양하고 복잡한 클라우드 자원을 효율적으로 관리하는 것이 중요합니다.</p>

<p>Terraform은 AWS, GCP, Microsoft Azure, OpenStack 등의 멀티 클라우드를 지원하므로 이를 활용해 코드로 인프라 자원을 효율적으로 관리할 수 있습니다.</p>

<ul>
  <li><a href="https://www.terraform.io/docs/providers/index.html">Terraform 지원 provider</a></li>
</ul>

<p>이 페이지에서는 terraform을 사용하여 IBM Cloud에 가상머신을 생성, 삭제하는 방법에 대해 설명합니다.</p>

<h2 id="준비하기">준비하기</h2>

<p>아래 가이드를 참고하여 Terraform 및 softlayer 플러그인을 설치합니다.</p>

<p>이 페이지에서는 아래와 같은 버전을 기준으로 작성했습니다.</p>

<ul>
  <li>Terraform : v0.11.7</li>
  <li>softlayer 플러그인 : 1.5.0</li>
</ul>

<h3 id="terraform-설치">Terraform 설치</h3>

<ul>
  <li>
    <p>아래 페이지에서 OS별 바이너리 다운로드</p>

    <p>https://www.terraform.io/downloads.html</p>
  </li>
  <li>
    <p>OSX</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  mv terraform /usr/local/bin
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="softlayer-플러그인-다운로드">softlayer 플러그인 다운로드</h3>

<ul>
  <li>
    <p>아래 페이지에서 OS별 바이너리 다운로드</p>

    <p>https://github.com/softlayer/terraform-provider-softlayer/releases</p>
  </li>
  <li>
    <p>아래와 같이 플러그인 경로 설정</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  # vi ~/.terraformrc
  providers {
      softlayer = "/path/to/bin/terraform-provider-softlayer"
  }
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="softlayer-포탈에서-ssh-key-생성">Softlayer 포탈에서 ssh key 생성</h3>

<p>Terraform을 이용하여 VM을 생성할 때 사용할 ssh key를 설정하는 방법입니다.</p>

<ul>
  <li>
    <p>디바이스 &gt; 관리 &gt; SSH 키 선택 &gt; 추가 탭 클릭</p>
  </li>
  <li>
    <p>퍼블릭 키 및 라벨 입력 후 추가 버튼 클릭(이 페이지에서는 ssh key 이름을 sl_key로 가정)</p>
  </li>
  <li>
    <p>Terraform <code class="highlighter-rouge">main.tf</code>에 위 키를 정의해서 VM 생성시 활용합니다.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  data "softlayer_ssh_key" "public_key" {
      label = "sl_key"
  }
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="자원-정의">자원 정의</h2>

<p>디렉토리를 생성하고 생성할 자원에 대한 정의를 합니다.</p>

<ul>
  <li>
    <p>자원 정의</p>

    <p>계정, ssh key, VM 등의 자원에 대해 정의합니다.</p>

    <p>자주 사용하는 값들은 변수화 해서 <code class="highlighter-rouge">vars.tf</code>에 정의합니다.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ vi main.tf

  //계정 정보
  provider "softlayer" {
    username = "${var.username}"
    api_key  = "${var.api_key}"
  }

  //VM에서 사용할 ssh key
  data "softlayer_ssh_key" "public_key" {
      label = "sl_key"
  }

  //VM 정의
  resource "softlayer_virtual_guest" "sample_vm" {
    count                = "${var.sample_vm_count}"                           //VM 개수
    os_reference_code    = "${var.os}"                                        //OS 타입
    public_vlan_id       = "${var.public_vlan_id}"                            //Public VLAN ID
    private_vlan_id      = "${var.private_vlan_id}"                           //Private VLAN ID
    domain               = "${var.domain}"                                    //VM의 도메인 명
    dedicated_acct_host_only = "${var.dedicated_host}"                        //Dedicated VM 생성 여부
    hostname             = "${var.sample_vm_hostname}-0${count.index+1}"      //VM의 호스트 명
    ssh_key_ids          = ["${data.softlayer_ssh_key.public_key.id}"]        //VM에서 사용할 ssh key
    datacenter           = "${var.datacenter}"                                //데이터센터 명
    disks                = [100,250]                                          //디스크 크기. SAN 타입[Primary Disk, Second Disk, ...]
    local_disk           = "${var.local_disk}"                                //로컬 디스크 사용여부
    hourly_billing       = "${var.hourly_billing}"                            //시간 단위 과금 사용여부
    private_network_only = "${var.private_network_only}"                      //VM 생성 시 사설 네트워크만 사용할지 여부. true일 경우 public_vlan_id 주석 처리 필요
    network_speed        = 1000                                               //VM 네트워크 속도. Shared VM 타입은 100Mbps가 최대
    cores                = 2                                                  //VM CPU Core 수
    memory               = 4096                                               //VM Memory 수
    notes                = "${var.notes}"                                     //VM에 대한 태크 명
  }
</code></pre></div>    </div>
  </li>
  <li>
    <p>환경 변수 정의</p>

    <p><code class="highlighter-rouge">main.tf</code>에서 사용하는 환경 변수를 정의합니다.</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ vi vars.tf

  variable username {}        //환경변수로 입력받기 위해 템플릿만 선언

  variable api_key {}         //환경변수로 입력받기 위해 템플릿만 선언

  variable datacenter {
      default = "seo01"
  }

  variable domain {
      default = "example.com"
  }

  variable dedicated_host {
      default = "false"
  }

  variable os {
      default = "CENTOS_7_64"
  }

  variable hourly_billing {
      default = "true"
  }

  variable private_network_only {
      default = "false"
  }

  variable local_disk {
      default = "false"
  }

  variable public_vlan_id {
      default = xxx
  }

  variable private_vlan_id {
      default = xxx
  }

  variable sample_vm_hostname {
      default = "sample"
  }

  variable sample_vm_count {
      default = 1
  }
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="ibm-account-정보-export">IBM Account 정보 export</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export IBM_ACCOUNT=xxx
export API_KEY=xxx
</code></pre></div></div>

<h2 id="초기화">초기화</h2>

<p>아래 명령 실행해 초기화</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform init
</code></pre></div></div>

<h2 id="자원-생성">자원 생성</h2>

<p>아래 명령 실행해 자원 생성</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform apply -var "username=$IBM_ACCOUNT" -var "api_key=$API_KEY"
</code></pre></div></div>

<h2 id="자원-삭제">자원 삭제</h2>

<p>아래 명령 실행해 자원 삭제</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform destroy -var "username=$IBM_ACCOUNT" -var "api_key=$API_KEY"
</code></pre></div></div>

  </div>
<div id="disqus_thread"></div>
<script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://sj-blog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script data-ad-client="ca-pub-7576652482735281" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <a class="u-url" href="/terraform/2018/06/29/terraform.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <!--h2 class="footer-heading">개발 노트</h2-->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Yun SangJun</li><li><a class="u-email" href="mailto:ysj188cm@gmail.com">ysj188cm@gmail.com</a></li>
            <li>subscribe <a href="/feed.xml">via RSS</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/yunsangjun"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">yunsangjun</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>iOS를 시작으로 개발자의 길로 들어서 모바일 프레임워크와 애플리케이션을 개발했고 이후, 웹 개발자로 커리어를 전환해 웹 프레임워크, IDE를 개발했습니다. 최근에는 Kubernetes 및 Cloud 환경에서 애플리케션을 개발하고 빌드, 배포, 모니터링하는 운영 단계를 자동화하는 DevOps 엔지니어링을 하고 있습니다.</p>
      </div>

    </div>

  </div>

</footer>
</body>

</html>
